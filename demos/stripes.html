<!DOCTYPE html>
<html >
<head>
  <meta charset="UTF-8">
  <title>Canvallax: Triangles</title>
  <meta name="viewport" content="width=device-width, initial-scale=1">

  <link rel="stylesheet" href="demos.css">

  <style type="text/css">
  /* Custom Styles for test */

  </style>
</head>
<body class="no-bg">

<script src='http://cdnjs.cloudflare.com/ajax/libs/gsap/1.18.0/TweenMax.min.js'></script>
<script src='../dist/canvallax.min.js'></script>
<script>

  var scene = canvallax.Scene({
      tracker: canvallax.TrackScroll({
        ease: 1,
        scale: 1,
        //invert: true
      }),
      fullscreen: true,
      transformOrigin: 'center center',
    }),
    width = document.body.clientWidth,
    height = document.body.clientHeight;

  // Adapted from http://gif.flrn.nl/post/139934732029

  var clone, vertClone,
      horiz = [],
      vert = [],
      count = 7,
      spacing = 25,
      size = 15,
      full = ((size + spacing) * (count - 1)) - (spacing * 2);

  var line = canvallax.Rectangle({
          fill: '#dadad0',
          x: Math.round(width/3) - full/2,
          y: Math.round(height/3) - full/2,
          width: full,
          height: size,
          zIndex: 20,
          transformOrigin: [0,0]
        }),
      vertLine = line.clone({
          width: size,
          height: size,
        });

  for (var i = 1; i < count; i++) {
    clone = line.clone({ y: line.y + (spacing * i) });
    horiz.push(clone);

    vertClone = vertLine.clone({ x: line.x + (spacing * i) });
    vert.push(vertClone);
  }

  scene.add(horiz);
  scene.add(vert);

  var mainColor = '#dadad0',
      curColor = mainColor;

  TweenLite.defaultEase = Power2.easeIn;

  var tl = new TimelineMax({ repeat: -1 }),
      label,
      speed = 0.53,
      delay = 0.38,
      offset = 0.1;

  label = 'start';
  tl.addLabel(label);

  tl.staggerTo(horiz,speed,{
    width: size,
  },offset,label);

  tl.staggerTo(vert,speed,{
    height: full,
    delay: delay
  },-offset,label);

  label = 'second';

  tl.addLabel(label);

  tl.staggerTo(vert,speed,{
    height: size,
    y: '+='+(full-size)
  },offset,label);

  tl.staggerTo(horiz,speed,{
    width: full,
    delay: delay
  },offset,label);

  label = 'third';
  tl.addLabel(label);

  tl.staggerTo(vert,speed,{
    height: full,
    y: vertLine.y,
    delay: delay
  },offset,label);

  tl.staggerTo(horiz,speed,{
    width: size,
    x: '+='+(full-size)
  },-offset,label);



  label = 'fourth';
  tl.addLabel(label);

  tl.staggerTo(vert,speed,{
    height: size,
    y: vertLine.y
  },-offset,label);

  tl.staggerTo(horiz,speed,{
    width: full,
    x: line.x,
    delay: delay
  },offset,label);

  tl.timeScale(1.2);
  tl.play();


  function invert(){

    document.body.style.backgroundColor = curColor;

    curColor= ( curColor == mainColor ? '#000' : mainColor );

    scene.each(function(el){
      el.fill = curColor;
    });

  }
  invert();



</script>
</body>
</html>
